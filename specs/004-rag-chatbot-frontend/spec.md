# Feature Specification: Frontend Integration of RAG Chatbot

**Feature Branch**: `feature/rag-chatbot-frontend`
**Created**: 2025-12-08
**Status**: Draft

## 1. Overview

This document specifies the design and requirements for the frontend integration of the RAG (Retrieval-Augmented Generation) chatbot. This is the fourth and final phase of the project, focusing on embedding a user-friendly chatbot interface within the Docusaurus-based book. This component will connect to the FastAPI backend (Spec-3) to provide users with an interactive way to query the book's content, either in its entirety or from selected text passages.

## 2. User Stories

### User Story 1: Full-Book Query (P1)
**As an end-user,** I want to open a chatbot widget on any page of the book and ask a question to get an answer based on the entire book's content.
- **Why**: So I can quickly find information or clarify concepts without manually searching through the chapters.
- **Acceptance Criteria**:
    1. A chatbot icon or button is always visible on the page.
    2. Clicking the icon opens a chat interface.
    3. I can type a question and submit it.
    4. The chatbot displays the answer generated by the backend, along with links to the source sections in the book.

### User Story 2: Selected-Text Query (P1)
**As an end-user,** I want to highlight a passage of text in the book, and have a small pop-up or button appear that lets me ask a question specifically about that selection.
- **Why**: So I can get a detailed explanation or summary of a specific part of the text that I'm currently reading.
- **Acceptance Criteria**:
    1. When I select text on the page, a "Ask about this" button appears.
    2. Clicking the button opens the chatbot interface with the selected text as context.
    3. I can type a question related to the selection.
    4. The chatbot provides an answer based only on the selected text.

### User Story 3: Responsive UI (P2)
**As an end-user,** I want the chatbot to be usable and look good on both my desktop and mobile devices.
- **Why**: So I can have a consistent and effective experience regardless of how I'm accessing the book.
- **Acceptance Criteria**:
    1. The chatbot interface adapts its layout for smaller screen sizes.
    2. The text selection feature is functional on touch devices.
    3. The chatbot does not obstruct the main content of the book on any device.

## 3. Functional Requirements

- **FR-001**: The system MUST provide a React component that serves as the chatbot UI.
- **FR-002**: This component MUST be integrated into the Docusaurus layout, making it accessible from all pages.
- **FR-003**: The chatbot UI MUST have an input field for user queries and a display area for conversation history.
- **FR-004**: The frontend MUST make API calls to the FastAPI backend from Spec-3.
- **FR-005**: For full-book queries, the frontend MUST send a POST request to the `/query/book` endpoint (or the unified `/query` endpoint).
- **FR-006**: For selected-text queries, the frontend MUST detect the selected text, get the corresponding chunk IDs (this may require coordination with how the book content is structured), and send a POST request to the `/query/selection` endpoint (or the unified `/query` endpoint) with the query and `chunk_ids`.
- **FR-007**: The UI MUST display the `answer` and `metadata` (source links) returned from the backend.
- **FR-008**: The source links in the response MUST be clickable and navigate the user to the correct section of the book.

## 4. Non-Functional Requirements

- **NFR-001 (Performance)**: The chatbot UI should load quickly and not significantly impact the book's overall page load time. API calls should feel responsive, with loading indicators to manage user expectations.
- **NFR-002 (Accessibility)**: The chatbot UI MUST be accessible, following WCAG 2.1 guidelines (e.g., keyboard navigable, screen reader compatible).
- **NFR-003 (Intrusiveness)**: The chatbot should be non-intrusive, appearing as a floating action button or a small tab that expands on click.
- **NFR-004 (Styling)**: The component should be styled to match the Docusaurus theme but also allow for future customization (theming).

## 5. Key Components / Architecture

The frontend will be built as a Docusaurus "swizzled" component or a custom plugin.

- **`ChatbotButton` Component**: A floating action button that is always visible and toggles the main chat window.
- **`ChatWindow` Component**: The main chat interface, containing the conversation display and input form.
- **`ConversationDisplay` Component**: Renders the history of questions and answers. It will be responsible for formatting the bot's responses, including the source links.
- **`ChatInput` Component**: A form with a text area for the user's query and a submit button.
- **`TextSelectionHandler`**: A utility or hook that listens for text selection events on the page and triggers the "Ask about this" pop-up. This will likely involve using the `window.getSelection()` browser API.
- **`apiClient.js`**: A dedicated module to handle all communication with the FastAPI backend, abstracting the `fetch` logic.

## 6. Backend Integration

- **API Endpoint**: The frontend will primarily interact with the `POST /query` endpoint of the Spec-3 backend.
- **Request Payload (Full-Book)**:
  ```json
  {
    "query": "User's question here"
  }
  ```
- **Request Payload (Selected-Text)**:
  ```json
  {
    "query": "User's question here",
    "chunk_ids": ["id_of_selected_chunk_1", "id_of_selected_chunk_2"]
  }
  ```
- **Response Handling**: The frontend will parse the JSON response, display the `answer`, and render the `metadata` as clickable source links. It will also handle API errors gracefully, showing an error message to the user.

## 7. Success Criteria

- **SC-001**: The chatbot UI is successfully embedded and visible on every page of the deployed Docusaurus site.
- **SC-002**: A user can ask a question in the chat window and receive a correctly formatted answer from the backend.
- **SC-003**: A user can select text, click the "Ask about this" button, and receive a contextually relevant answer.
- **SC-004**: The source links in the response navigate to the correct page and section.
- **SC-005**: The UI is responsive and usable on both desktop and mobile screen sizes.
- **SC-006**: The integration does not introduce any breaking changes to the existing Docusaurus site.
