# API Contract: RAG Content Ingestion Service

## Overview
This document defines the API contract for the RAG Content Ingestion Pipeline service. The service provides endpoints for ingesting content from websites, managing the ingestion process, and querying stored content.

## Base URL
```
https://api.yourdomain.com/v1
```

## Authentication
All endpoints require API key authentication via header:
```
Authorization: Bearer {API_KEY}
```

## Endpoints

### 1. Ingest Content
Initiates the content ingestion process from specified URLs.

```
POST /ingest
```

#### Request Body
```json
{
  "urls": ["https://example.com/page1", "https://example.com/page2"],
  "options": {
    "chunk_size": 512,
    "chunk_overlap": 50,
    "batch_size": 10,
    "max_concurrent": 5,
    "collection_name": "rag_content_chunks"
  }
}
```

#### Response
```json
{
  "job_id": "ingest-job-12345",
  "status": "in_progress",
  "urls": ["https://example.com/page1", "https://example.com/page2"],
  "created_at": "2025-12-16T10:00:00Z",
  "estimated_completion": "2025-12-16T10:05:00Z"
}
```

### 2. Get Job Status
Retrieves the status of an ingestion job.

```
GET /ingest/{job_id}
```

#### Response
```json
{
  "job_id": "ingest-job-12345",
  "status": "completed",
  "processed_count": 25,
  "error_count": 0,
  "total_chunks": 150,
  "created_at": "2025-12-16T10:00:00Z",
  "completed_at": "2025-12-16T10:03:25Z",
  "summary": {
    "urls_processed": 25,
    "chunks_created": 150,
    "total_tokens": 75000
  }
}
```

### 3. Search Content
Performs a similarity search against stored content.

```
POST /search
```

#### Request Body
```json
{
  "query": "What is the main concept discussed?",
  "collection_name": "rag_content_chunks",
  "limit": 5,
  "filters": {
    "source_url": "https://example.com/specific-page"
  }
}
```

#### Response
```json
{
  "query": "What is the main concept discussed?",
  "results": [
    {
      "id": "chunk-123",
      "score": 0.85,
      "content": "The main concept discussed is...",
      "source_url": "https://example.com/page1",
      "section_title": "Introduction",
      "metadata": {
        "chunk_index": 0,
        "page_title": "Getting Started Guide"
      }
    }
  ],
  "search_time_ms": 45
}
```

### 4. List Collections
Retrieves a list of available collections.

```
GET /collections
```

#### Response
```json
{
  "collections": [
    {
      "name": "rag_content_chunks",
      "vector_size": 1536,
      "point_count": 1500,
      "created_at": "2025-12-16T09:00:00Z"
    }
  ]
}
```

### 5. Get Collection Details
Retrieves detailed information about a specific collection.

```
GET /collections/{collection_name}
```

#### Response
```json
{
  "name": "rag_content_chunks",
  "vector_size": 1536,
  "point_count": 1500,
  "indexed_vector_count": 1500,
  "segments_count": 1,
  "disk_usage_bytes": 1234567,
  "ram_usage_bytes": 7654321,
  "created_at": "2025-12-16T09:00:00Z"
}
```

## Error Responses

All error responses follow the same structure:

```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "Human-readable error message",
    "details": "Additional error details"
  }
}
```

### Common Error Codes
- `INVALID_INPUT`: Request data is invalid
- `AUTHENTICATION_FAILED`: Invalid or missing API key
- `RESOURCE_NOT_FOUND`: Requested resource does not exist
- `RATE_LIMIT_EXCEEDED`: API rate limit exceeded
- `INTERNAL_ERROR`: Internal server error

## Data Types

### ContentChunk
- `id` (string): Unique identifier for the chunk
- `content` (string): The text content
- `source_url` (string): Original URL where content was found
- `chunk_index` (integer): Index of this chunk within the source
- `section_title` (string, optional): Title of the section
- `page_title` (string, optional): Title of the source page
- `metadata` (object): Additional metadata

### IngestionJob
- `job_id` (string): Unique identifier for the job
- `status` (string): Current status (pending, in_progress, completed, failed)
- `processed_count` (integer): Number of URLs processed
- `error_count` (integer): Number of URLs that failed
- `total_chunks` (integer): Total number of chunks created
- `created_at` (string): ISO 8601 timestamp
- `completed_at` (string, optional): ISO 8601 timestamp